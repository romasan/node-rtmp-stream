<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Моё Telegram Web App</title>
	<script src="https://telegram.org/js/telegram-web-app.js"></script>
	<style>
		body {
			font-family: -apple-system, BlinkMacSystemFont, sans-serif;
			padding: 20px;
			background-image: repeating-conic-gradient(#d9d7ff 0% 25%, #f4f4f4 0% 50%);
			background-position: 0 0, 16px 16px;
			background-size: 32px 32px;
			background-color: #c5c4fe;
			color: #000;
		}
	</style>
</head>

<body>
	<h1 id="greeting">Загрузка...</h1>
	<button id="sendBtn" style="display:none;">Отправить в чат</button>

	<script>
		const tg = window.Telegram.WebApp;
		tg.expand();
		// setInterval(() => {
		// 	tg.expand();
		// }, 333);

		tg.setBackgroundColor('#d9d7ff');
		tg.setHeaderColor('#d9d7ff');

		const user = tg.initDataUnsafe?.user;
		const greeting = user ? `Привет, ${user.first_name}! (#${user?.id})` : 'Привет, аноним!';
		document.getElementById('greeting').textContent = greeting;

		// Пример отправки данных обратно в бот
		document.getElementById('sendBtn').onclick = () => {
			tg.sendData(JSON.stringify({ action: "hello", from: user?.id || "anon" }));
			tg.close();
		};

		// Показать кнопку, если приложение запущено из чата
		if (tg.initDataUnsafe?.start_param) {
			document.getElementById('sendBtn').style.display = 'block';
		}

		const initData = tg.initData; // это строка вида "query_id=...&user=...&auth_date=...&hash=..."
		fetch('https://dev-api.pixelbattles.ru/auth/telegram', {
			method: 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
			body: initData
		})
			.then(r => r.text())
			.then(text => {
				// теперь у вас есть session_id, user_id и т.д.
				// document.write(`Result: "${text}"`);
			});
	</script>
</body>

</html>