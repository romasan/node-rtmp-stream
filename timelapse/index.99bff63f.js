function e(e){return e&&e.__esModule?e.default:e}var t,r=globalThis,n={},s={},a=r.parcelRequire8661;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in s){var t=s[e];delete s[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){s[e]=t},r.parcelRequire8661=a),a.register;var l=a("iM5HV");a("fYo6y");var c=a("b2S2j"),l=a("iM5HV"),u=a("fYo6y"),o=a("PTcTU"),i=a("fvstS"),d=a("g7WMx"),f=a("5Ml5F"),x=a("ifBWf"),h=a("cu5bI");t="gWqsmq_button";const p=(e,t)=>{let r=e.expands.filter(e=>e.index.from<=t).length-1,n=e.expands[r],s=Math.floor((t-n.index.from+1)/e.partSize),a=e.expands.slice(0,r).reduce((e,t)=>e+(t.part.to-t.part.from+1),0)+s;return{expandIndex:r,partIndex:s,globalPartIndex:a,expand:n}},g=async(e,t)=>{let r=[];try{let n=await (0,f.fetchTimelapsePartBin)(e,t),s=await n.arrayBuffer(),a=await (0,x.gzipAB)(s),l=new Uint16Array(a.buffer),c=[];l.forEach(e=>{c.push(e),3===c.length&&(r.push(c),c=[])})}catch(e){console.log("Error:",e)}return r},m=(e,t,r)=>{let n=e.getContext("2d"),s=document.createElement("canvas"),a=s.getContext("2d");s.width=e.width,s.height=e.height,a.drawImage(e,0,0),e.width=t,e.height=r,n.fillStyle="#ffffff",n.fillRect(0,0,t,r),n.drawImage(s,0,0)};var f=a("5Ml5F"),v=a("d165e");(0,f.start)().then(e=>{if("fail"===e){document.location.reload();return}(0,v.connect)()}).catch(()=>{}),(0,c.createRoot)(document.getElementById("root")).render(/*#__PURE__*/(0,l.jsx)(()=>{let[r,n]=(0,u.useState)("s1e2"),[s,a]=(0,u.useState)({}),[c,x]=(0,u.useState)(15e3),v=(0,u.useRef)(c),w=(0,u.useRef)(null),y=(0,u.useRef)({fillRect:()=>null}),R=(0,u.useRef)(!1),[S,M]=(0,u.useState)(!1),q=(0,u.useRef)(0),j=(0,u.useRef)(0),[E,I]=(0,u.useState)(0),b=(0,u.useRef)([]),C=(0,u.useRef)(null),N=(0,u.useRef)(null),_=(0,u.useRef)(0),W=(0,u.useRef)(-1),z=(0,u.useRef)(()=>{}),B=(0,u.useRef)(()=>{}),[P,k]=(0,u.useState)(-1),[O,$]=(0,u.useState)(-1),A=(0,u.useMemo)(()=>`${f.APIhost}/timelapse/${r}/${E}.png`,[r,E]),D=(0,u.useMemo)(()=>{let{width:e}=C.current?C.current.getBoundingClientRect():{};return e/s.total},[s]),{wsStore:F,isAuthorized:T,isOnline:H,hasNewMessage:U,setHasNewMessage:L}=(0,h.useWsStore)(),V=/*@__PURE__*/e(i)(),Y=async()=>{try{let e=await (0,f.fetchTimelapse)(r);a(e)}catch(e){}},X=async e=>{b.current[e]||(b.current[e]=!0,b.current[e]=await g(r,e),k(e))},G=()=>{N.current&&(N.current.style.width=`${j.current*D}px`)},J=()=>{q.current=Date.now(),R.current=!0,M(!0),Q()},K=()=>{R.current=!1,M(!1)},Q=()=>{if(!R.current||!s.expands)return;let e=Date.now()-q.current;if(e){let t=Math.floor(v.current/1e3*e);G();let{expandIndex:r,partIndex:n,globalPartIndex:a,expand:l}=p(s,j.current),c=l.index.from+n*s.partSize,u=Math.min(l.index.to-1,c+s.partSize-1),o=s.expands[r-1],i=(o&&o.index.to||0)+n*s.partSize;a<=s.totalParts-1&&!b.current[a+1]&&X(a+1);let d=u-j.current;d<t&&(t=d),W.current!==r&&(W.current=r,r&&(m(w.current,l.canvas.width,l.canvas.height),z.current()));for(let e=0;e<t;e++){let t=j.current-i+e;try{if(t>=0){let[e,r,n]=b.current[a][t];y.current.fillStyle=s.colors[e],y.current.fillRect(r,n,1,1),_.current=_.current+1}}catch(e){console.log("Error:",e,t)}}j.current=j.current+(t<=0?1:t)}if(q.current=Date.now(),j.current>=s.total-1){K();// playCursor.current = 0;
// moveTimelapseCursor();
return}requestAnimationFrame(Q)},Z=()=>{if(!s.expands||R.current)return;let{partIndex:e,globalPartIndex:t,expand:r}=p(s,j.current),n=j.current-(r.index.from+e*s.partSize);B.current();for(let e=0;e<n;e++)try{let[r,n,a]=b.current[t][e];y.current.fillStyle=s.colors[r],y.current.fillRect(n,a,1,1)}catch(e){console.log("Error:",e);return}},ee=()=>{R.current?K():J()};return(0,u.useEffect)(()=>{s&&s.episode===r&&b.current[E]&&b.current[E].length&&Z()},[E,r,s,P,O]),(0,u.useEffect)(()=>{r&&(K(),j.current=0,b.current=[],I(0),X(0),Y(),G())},[r]),(0,u.useEffect)(()=>{v.current=c},[c]),(0,u.useEffect)(()=>{let e=e=>{32===e.keyCode&&ee()};return document.body.addEventListener("keyup",e),()=>{document.body.removeEventListener("keyup",e)}},[s]),/*#__PURE__*/(0,l.jsxs)("div",{className:/*@__PURE__*/e(o)("gWqsmq_root",{mobile:V}),children:[/*#__PURE__*/(0,l.jsx)(d.Header,{isAuthorized:T,name:F?F.name:"",isOnline:H,hasNewMessage:U,setHasNewMessage:L}),/*#__PURE__*/(0,l.jsx)(d.Canvas,{color:"",isOnline:H,onInit:({image:e,centering:t,resetImage:r})=>{w.current=e,y.current=e&&e.getContext&&e.getContext("2d"),z.current=t,B.current=r},viewOnly:!0,src:A}),/*#__PURE__*/(0,l.jsxs)("div",{className:"gWqsmq_controls",children:[/*#__PURE__*/(0,l.jsxs)("select",{onChange:e=>{n(e.target.value)},children:[/*#__PURE__*/(0,l.jsx)("option",{value:"s1e1",children:"S1E1"}),/*#__PURE__*/(0,l.jsx)("option",{value:"s1e2",selected:!0,children:"S1E2"})]}),/*#__PURE__*/(0,l.jsx)("button",{className:t,onClick:ee,children:S?"⏸":"⏵"}),/*#__PURE__*/(0,l.jsx)("div",{className:"gWqsmq_vDelimiter"}),/*#__PURE__*/(0,l.jsx)("button",{className:t,onClick:()=>{x(e=>Math.floor(e/1.1))},children:"–"}),/*#__PURE__*/(0,l.jsx)("button",{className:t,onClick:()=>{x(e=>Math.floor(1.1*e))},children:"+"}),"speed: ",c," pix per sec"]}),/*#__PURE__*/(0,l.jsx)("div",{className:"gWqsmq_timelapse",ref:C,onClick:e=>{if(!s.expands)return;let{width:t,left:r}=C.current?C.current.getBoundingClientRect():{},n=Math.floor((e.clientX-r)/t*s.total),{globalPartIndex:a}=p(s,n);K(),j.current=n,$(n),G(),I(a),X(a)},children:(()=>{if(!C.current&&!s.total)return null;let{width:t}=C.current.getBoundingClientRect(),r=t/s.total;return/*#__PURE__*/(0,l.jsxs)(l.Fragment,{children:[s.expands&&s.expands.map(t=>/*#__PURE__*/(0,l.jsx)(l.Fragment,{children:/*#__PURE__*/(0,l.jsx)("div",{className:/*@__PURE__*/e(o)("gWqsmq_position","gWqsmq_positionExpand"),style:{left:`${Math.floor(t.index.from*r)}px`}},`${t.index.from}-${t.index.to}`)})),/*#__PURE__*/(0,l.jsx)("div",{ref:N,className:"gWqsmq_progress"},"progress")]})})()})]})},{}));