function e(e){return e&&e.__esModule?e.default:e}var t,r=globalThis,n={},s={},a=r.parcelRequire8661;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in s){var t=s[e];delete s[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){s[e]=t},r.parcelRequire8661=a),a.register;var l=a("iM5HV");a("fYo6y");var i=a("b2S2j"),l=a("iM5HV"),o=a("fYo6y"),c=a("PTcTU"),u=a("fvstS"),d=a("g7WMx"),x=a("5Ml5F"),f=a("ifBWf"),h=a("cu5bI"),m=a("hasHI"),l=a("iM5HV");a("fYo6y");var g=e=>(0,l.jsx)("svg",{viewBox:"171.843 150.662 31.29 36.901",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,l.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -16.564 -16.564)"})}),l=a("iM5HV");a("fYo6y");var p=e=>(0,l.jsx)("svg",{viewBox:"171.724 150.559 31.496 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,l.jsx)("path",{d:"M171.724 150.713h10.565v37.01h-10.565zm20.931-.154h10.565v37.01h-10.565z"})}),l=a("iM5HV");a("fYo6y");var v=e=>(0,l.jsxs)("svg",{viewBox:"171.724 150.559 62.416 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,l.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -16.564 -16.564)"}),(0,l.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -1.07 -1.05)"})]}),l=a("iM5HV");a("fYo6y");var w=e=>(0,l.jsxs)("svg",{viewBox:"171.724 150.559 62.415 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,l.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"matrix(0 1 1 0 -2.24 0)"}),(0,l.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"matrix(0 1 1 0 -33.246 .02)"})]});t="gWqsmq_button";const j=(e,t)=>{let r=e.expands.filter(e=>e.index.from<=t).length-1,n=e.expands[r],s=Math.floor((t-n.index.from+1)/e.partSize),a=e.expands.slice(0,r).reduce((e,t)=>e+(t.part.to-t.part.from+1),0)+s;return{expandIndex:r,partIndex:s,globalPartIndex:a,expand:n}},y=async(e,t)=>{let r=[];try{let n=await (0,x.fetchTimelapsePartBin)(e,t),s=await n.arrayBuffer(),a=await (0,f.gzipAB)(s),l=new Uint16Array(a.buffer),i=[];l.forEach(e=>{i.push(e),3===i.length&&(r.push(i),i=[])})}catch(e){console.log("Error:",e)}return r},M=(e,t,r)=>{let n=e.getContext("2d"),s=document.createElement("canvas"),a=s.getContext("2d");s.width=e.width,s.height=e.height,a.drawImage(e,0,0),e.width=t,e.height=r,n.fillStyle="#ffffff",n.fillRect(0,0,t,r),n.drawImage(s,0,0)};var x=a("5Ml5F"),q=a("d165e");(0,x.start)().then(e=>{if("fail"===e){document.location.reload();return}(0,q.connect)()}).catch(()=>{}),(0,i.createRoot)(document.getElementById("root")).render((0,l.jsx)(()=>{let[r,n]=(0,o.useState)("s1e2"),[s,a]=(0,o.useState)({}),[i,f]=(0,o.useState)(15e3),q=(0,o.useRef)(i),R=(0,o.useRef)(null),S=(0,o.useRef)({fillRect:()=>null}),N=(0,o.useRef)(!1),[b,E]=(0,o.useState)(!1),I=(0,o.useRef)(0),C=(0,o.useRef)(0),[_,W]=(0,o.useState)(0),B=(0,o.useRef)([]),O=(0,o.useRef)(null),z=(0,o.useRef)(null),H=(0,o.useRef)(0),F=(0,o.useRef)(-1),P=(0,o.useRef)(()=>{}),k=(0,o.useRef)(()=>{}),[$,A]=(0,o.useState)(-1),[D,T]=(0,o.useState)(-1),V=(0,o.useMemo)(()=>`${x.APIhost}/timelapse/${r}/${_}.png`,[r,_]),Y=(0,o.useMemo)(()=>{let{width:e}=O.current?O.current.getBoundingClientRect():{};return(e-3)/s.total},[s]),{wsStore:Z,isAuthorized:L,isOnline:U,hasNewMessage:X,setHasNewMessage:G}=(0,h.useWsStore)(),J=e(u)(),K=(0,m.useModal)({content:(0,l.jsx)(d.Login,{}),width:"300px"}),Q=async()=>{try{let e=await (0,x.fetchTimelapse)(r);a(e)}catch(e){}},ee=async e=>{B.current[e]||(B.current[e]=!0,B.current[e]=await y(r,e),A(e))},et=()=>{z.current&&(z.current.style.width=`${C.current*Y}px`)},er=()=>{I.current=Date.now(),N.current=!0,E(!0),es()},en=()=>{N.current=!1,E(!1)},es=()=>{if(!N.current||!s.expands)return;let e=Date.now()-I.current;if(e){let t=Math.floor(q.current/1e3*e);et();let{expandIndex:r,partIndex:n,globalPartIndex:a,expand:l}=j(s,C.current),i=l.index.from+n*s.partSize,o=Math.min(l.index.to-1,i+s.partSize-1),c=s.expands[r-1],u=(c&&c.index.to||0)+n*s.partSize;a<=s.totalParts-1&&!B.current[a+1]&&ee(a+1);let d=o-C.current;d<t&&(t=d),F.current!==r&&(F.current=r,r&&(M(R.current,l.canvas.width,l.canvas.height),P.current()));for(let e=0;e<t;e++){let t=C.current-u+e;try{if(t>=0){let[e,r,n]=B.current[a][t];S.current.fillStyle=s.colors[e],S.current.fillRect(r,n,1,1),H.current=H.current+1}}catch(e){console.log("Error:",e,t)}}C.current=C.current+(t<=0?1:t)}if(I.current=Date.now(),C.current>=s.total-1){en();return}requestAnimationFrame(es)},ea=()=>{if(!s.expands||N.current)return;let{partIndex:e,globalPartIndex:t,expand:r}=j(s,C.current),n=C.current-(r.index.from+e*s.partSize);k.current();for(let e=0;e<n;e++)try{let[r,n,a]=B.current[t][e];S.current.fillStyle=s.colors[r],S.current.fillRect(n,a,1,1)}catch(e){console.log("Error:",e);return}},el=()=>{N.current?en():er()};return(0,o.useEffect)(()=>{s&&s.episode===r&&B.current[_]&&B.current[_].length&&ea()},[_,r,s,$,D]),(0,o.useEffect)(()=>{r&&(en(),C.current=0,B.current=[],W(0),ee(0),Q(),et())},[r]),(0,o.useEffect)(()=>{q.current=i},[i]),(0,o.useEffect)(()=>{let e=e=>{32===e.keyCode&&el()};return document.body.addEventListener("keyup",e),()=>{document.body.removeEventListener("keyup",e)}},[s]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:e(c)("gWqsmq_root",{mobile:J}),children:[(0,l.jsx)(d.Header,{isAuthorized:L,name:Z?Z.name:"",isOnline:U,hasNewMessage:X,setHasNewMessage:G,login:K.open}),(0,l.jsx)(d.Canvas,{color:"",isOnline:U,onInit:({image:e,centering:t,resetImage:r})=>{R.current=e,S.current=e&&e.getContext&&e.getContext("2d"),P.current=t,k.current=r},viewOnly:!0,src:V}),(0,l.jsxs)("div",{className:"gWqsmq_bar",children:[(0,l.jsx)("div",{className:"gWqsmq_timelapse",ref:O,onClick:e=>{if(!s.expands)return;let{width:t,left:r}=O.current?O.current.getBoundingClientRect():{},n=Math.floor((e.clientX-r)/t*s.total),{globalPartIndex:a}=j(s,n);en(),C.current=n,T(n),et(),W(a),ee(a)},children:(()=>{if(!O.current&&!s.total)return null;let{width:t}=O.current.getBoundingClientRect(),r=t/s.total;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{ref:z,className:"gWqsmq_progress"},"progress"),s.expands&&s.expands.slice(1).map(t=>(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{className:e(c)("gWqsmq_position","gWqsmq_positionExpand"),style:{left:`${Math.floor(t.index.from*r)}px`}},`${t.index.from}-${t.index.to}`)}))]})})()}),(0,l.jsxs)("div",{className:"gWqsmq_controls",children:[(0,l.jsxs)("div",{className:"gWqsmq_leftControls",children:[(0,l.jsx)("button",{className:t,onClick:el,children:b?(0,l.jsx)(p,{}):(0,l.jsx)(g,{})}),(0,l.jsx)("div",{className:"gWqsmq_vDelimiter"}),(0,l.jsx)("button",{className:t,onClick:()=>{f(e=>Math.floor(e/1.1))},children:(0,l.jsx)(w,{})}),(0,l.jsx)("button",{className:t,onClick:()=>{f(e=>Math.floor(1.1*e))},children:(0,l.jsx)(v,{})}),Number((i/15e3).toFixed(2)),"X"]}),(0,l.jsxs)("div",{children:["Сезон:",(0,l.jsxs)("select",{onChange:e=>{n(e.target.value)},children:[(0,l.jsx)("option",{value:"s1e1",children:"S1E1"}),(0,l.jsx)("option",{value:"s1e2",selected:!0,children:"S1E2"})]})]})]})]})]}),K.render()]})},{}));