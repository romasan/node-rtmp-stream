function e(e){return e&&e.__esModule?e.default:e}var t,r,n=globalThis,s={},a={},l=n.parcelRequire8661;null==l&&((l=function(e){if(e in s)return s[e].exports;if(e in a){var t=a[e];delete a[e];var r={id:e,exports:{}};return s[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){a[e]=t},n.parcelRequire8661=l),l.register;var i=l("iM5HV");l("fYo6y");var o=l("b2S2j"),i=l("iM5HV"),c=l("fYo6y"),u=l("PTcTU"),d=l("fvstS"),x=l("g7WMx"),f=l("5Ml5F"),h=l("ifBWf"),m=l("cu5bI"),g=l("hasHI"),i=l("iM5HV");l("fYo6y");var p=e=>(0,i.jsx)("svg",{viewBox:"171.843 150.662 31.29 36.901",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -16.564 -16.564)"})}),i=l("iM5HV");l("fYo6y");var v=e=>(0,i.jsx)("svg",{viewBox:"171.724 150.559 31.496 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("path",{d:"M171.724 150.713h10.565v37.01h-10.565zm20.931-.154h10.565v37.01h-10.565z"})}),i=l("iM5HV");l("fYo6y");var w=e=>(0,i.jsxs)("svg",{viewBox:"171.724 150.559 62.416 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,i.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -16.564 -16.564)"}),(0,i.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -1.07 -1.05)"})]}),i=l("iM5HV");l("fYo6y");var j=e=>(0,i.jsxs)("svg",{viewBox:"171.724 150.559 62.415 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,i.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"matrix(0 1 1 0 -2.24 0)"}),(0,i.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"matrix(0 1 1 0 -33.246 .02)"})]});t="gWqsmq_button",r="gWqsmq_vDelimiter";const y=(e,t)=>{let r=e.expands.filter(e=>e.index.from<=t).length-1,n=e.expands[r],s=Math.floor((t-n.index.from+1)/e.partSize),a=e.expands.slice(0,r).reduce((e,t)=>e+(t.part.to-t.part.from+1),0)+s;return{expandIndex:r,partIndex:s,globalPartIndex:a,expand:n}},M=async(e,t)=>{let r=[];try{let n=await (0,f.fetchTimelapsePartBin)(e,t),s=await n.arrayBuffer(),a=await (0,h.gzipAB)(s),l=new Uint16Array(a.buffer),i=[];l.forEach(e=>{i.push(e),3===i.length&&(r.push(i),i=[])})}catch(e){console.log("Error:",e)}return r},q=(e,t,r)=>{let n=e.getContext("2d"),s=document.createElement("canvas"),a=s.getContext("2d");s.width=e.width,s.height=e.height,a.drawImage(e,0,0),e.width=t,e.height=r,n.fillStyle="#ffffff",n.fillRect(0,0,t,r),n.drawImage(s,0,0)};var f=l("5Ml5F"),R=l("d165e");(0,f.start)().then(e=>{if("fail"===e){document.location.reload();return}(0,R.connect)()}).catch(()=>{}),(0,o.createRoot)(document.getElementById("root")).render((0,i.jsx)(()=>{let[n,s]=(0,c.useState)("s2e1"),[a,l]=(0,c.useState)({}),[o,R]=(0,c.useState)(15e3),S=(0,c.useRef)(o),N=(0,c.useRef)(null),b=(0,c.useRef)({fillRect:()=>null}),E=(0,c.useRef)(!1),[I,C]=(0,c.useState)(!1),_=(0,c.useRef)(0),W=(0,c.useRef)(0),[B,O]=(0,c.useState)(0),z=(0,c.useRef)([]),H=(0,c.useRef)(null),$=(0,c.useRef)(null),F=(0,c.useRef)(0),P=(0,c.useRef)(-1),k=(0,c.useRef)(()=>{}),A=(0,c.useRef)(()=>{}),[D,T]=(0,c.useState)(-1),[V,Y]=(0,c.useState)(-1),[Z,L]=(0,c.useState)(""),U=(0,c.useMemo)(()=>`${f.APIhost}/timelapse/${n}/${B}.png`,[n,B]),X=(0,c.useMemo)(()=>{let{width:e}=H.current?H.current.getBoundingClientRect():{};return(e-3)/a.total},[a]),{wsStore:G,isAuthorized:J,isOnline:K,hasNewMessage:Q,setHasNewMessage:ee}=(0,m.useWsStore)(),et=e(d)(),er=(0,g.useModal)({content:(0,i.jsx)(x.Login,{}),width:"300px"}),en=async()=>{try{let e=await (0,f.fetchTimelapse)(n);l(e)}catch(e){}},es=async e=>{z.current[e]||(z.current[e]=!0,z.current[e]=await M(n,e),T(e))},ea=()=>{$.current&&($.current.style.width=`${W.current*X}px`)},el=()=>{_.current=Date.now(),E.current=!0,C(!0),eo()},ei=()=>{E.current=!1,C(!1)},eo=()=>{if(!E.current||!a.expands)return;let e=Date.now()-_.current;if(e){let t=Math.floor(S.current/1e3*e);ea();let{expandIndex:r,partIndex:n,globalPartIndex:s,expand:l}=y(a,W.current),i=l.index.from+n*a.partSize,o=Math.min(l.index.to-1,i+a.partSize-1),c=a.expands[r-1],u=(c&&c.index.to||0)+n*a.partSize;s<=a.totalParts-1&&!z.current[s+1]&&es(s+1);let d=o-W.current;d<t&&(t=d),P.current!==r&&(P.current=r,r&&(q(N.current,l.canvas.width,l.canvas.height),k.current()));for(let e=0;e<t;e++){let t=W.current-u+e;try{if(t>=0){let[e,r,n]=z.current[s][t];b.current.fillStyle=a.colors[e],b.current.fillRect(r,n,1,1),F.current=F.current+1}}catch(e){console.log("Error:",e,t)}}W.current=W.current+(t<=0?1:t)}if(_.current=Date.now(),W.current>=a.total-1){ei();return}requestAnimationFrame(eo)},ec=()=>{if(!a.expands||E.current)return;let{partIndex:e,globalPartIndex:t,expand:r}=y(a,W.current),n=W.current-(r.index.from+e*a.partSize);A.current();for(let e=0;e<n;e++)try{let[r,n,s]=z.current[t][e];b.current.fillStyle=a.colors[r],b.current.fillRect(n,s,1,1)}catch(e){console.log("Error:",e);return}},eu=()=>{E.current?ei():el()};return(0,c.useEffect)(()=>{a&&a.episode===n&&z.current[B]&&z.current[B].length&&ec()},[B,n,a,D,V]),(0,c.useEffect)(()=>{n&&(ei(),W.current=0,z.current=[],O(0),es(0),en(),ea())},[n]),(0,c.useEffect)(()=>{S.current=o},[o]),(0,c.useEffect)(()=>{let e=e=>{32===e.keyCode&&eu()};return document.body.addEventListener("keyup",e),()=>{document.body.removeEventListener("keyup",e)}},[a]),(0,c.useEffect)(()=>{let e=setInterval(()=>{L(`${(0,h.formatNumber)(W.current?W.current+1:0)} / ${a?(0,h.formatNumber)(a.total):0}`)},300);return()=>{clearInterval(e)}},[a]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:e(u)("gWqsmq_root",{mobile:et}),children:[(0,i.jsx)(x.Header,{isAuthorized:J,name:G?G.name:"",isOnline:K,hasNewMessage:Q,setHasNewMessage:ee,login:er.open}),(0,i.jsx)(x.Canvas,{color:"",isOnline:K,onInit:({image:e,centering:t,resetImage:r})=>{N.current=e,b.current=e&&e.getContext&&e.getContext("2d"),k.current=t,A.current=r},viewOnly:!0,src:U}),(0,i.jsxs)("div",{className:"gWqsmq_bar",children:[(0,i.jsx)("div",{className:"gWqsmq_timelapse",ref:H,onClick:e=>{if(!a.expands)return;let{width:t,left:r}=H.current?H.current.getBoundingClientRect():{},n=Math.floor((e.clientX-r)/t*a.total),{globalPartIndex:s}=y(a,n);ei(),W.current=n,Y(n),ea(),O(s),es(s)},children:(()=>{if(!H.current&&!a.total)return null;let{width:t}=H.current.getBoundingClientRect(),r=t/a.total;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{ref:$,className:"gWqsmq_progress"},"progress"),a.expands&&a.expands.slice(1).map(t=>(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:e(u)("gWqsmq_position","gWqsmq_positionExpand"),style:{left:`${Math.floor(t.index.from*r)}px`}},`${t.index.from}-${t.index.to}`)}))]})})()}),(0,i.jsxs)("div",{className:"gWqsmq_controls",children:[(0,i.jsxs)("div",{className:"gWqsmq_leftControls",children:[(0,i.jsx)("button",{className:t,onClick:eu,children:I?(0,i.jsx)(v,{}):(0,i.jsx)(p,{})}),(0,i.jsx)("div",{className:r}),(0,i.jsx)("button",{className:t,onClick:()=>{R(e=>Math.floor(e/1.1))},children:(0,i.jsx)(j,{})}),(0,i.jsx)("button",{className:t,onClick:()=>{R(e=>Math.floor(1.1*e))},children:(0,i.jsx)(w,{})}),Number((o/15e3).toFixed(2)),"X",(0,i.jsx)("div",{className:r}),Z," pix"]}),(0,i.jsxs)("div",{children:["Сезон:",(0,i.jsxs)("select",{onChange:e=>{s(e.target.value)},children:[(0,i.jsx)("option",{value:"s1e1",children:"S1E1"}),(0,i.jsx)("option",{value:"s1e2",children:"S1E2"}),(0,i.jsx)("hr",{}),(0,i.jsx)("option",{value:"s2e1",selected:!0,children:"S2E1"})]})]})]})]})]}),er.render()]})},{}));