function e(e){return e&&e.__esModule?e.default:e}var t,r,n=globalThis,s={},a={},l=n.parcelRequire8661;null==l&&((l=function(e){if(e in s)return s[e].exports;if(e in a){var t=a[e];delete a[e];var r={id:e,exports:{}};return s[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){a[e]=t},n.parcelRequire8661=l),l.register;var o=l("iM5HV");l("fYo6y");var i=l("b2S2j"),o=l("iM5HV"),c=l("fYo6y"),u=l("PTcTU"),d=l("fvstS"),x=l("g7WMx"),f=l("5Ml5F"),h=l("hasHI"),m=l("ifBWf"),g=l("cu5bI"),o=l("iM5HV");l("fYo6y");var p=e=>(0,o.jsx)("svg",{viewBox:"171.843 150.662 31.29 36.901",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,o.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -16.564 -16.564)"})}),o=l("iM5HV");l("fYo6y");var v=e=>(0,o.jsx)("svg",{viewBox:"171.724 150.559 31.496 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,o.jsx)("path",{d:"M171.724 150.713h10.565v37.01h-10.565zm20.931-.154h10.565v37.01h-10.565z"})}),o=l("iM5HV");l("fYo6y");var w=e=>(0,o.jsxs)("svg",{viewBox:"171.724 150.559 62.416 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,o.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -16.564 -16.564)"}),(0,o.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"rotate(90 -1.07 -1.05)"})]}),o=l("iM5HV");l("fYo6y");var j=e=>(0,o.jsxs)("svg",{viewBox:"171.724 150.559 62.415 37.164",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,o.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"matrix(0 1 1 0 -2.24 0)"}),(0,o.jsx)("path",{d:"m220.246 153.468 18.82 31.29h-36.901l18.081-31.29Z",style:{transformOrigin:"220.615px 169.113px"},transform:"matrix(0 1 1 0 -33.246 .02)"})]});t="gWqsmq_button",r="gWqsmq_vDelimiter";const y=(e,t)=>{let r=e.expands.filter(e=>e.index.from<=t).length-1,n=e.expands[r],s=Math.floor((t-n.index.from+1)/e.partSize),a=e.expands.slice(0,r).reduce((e,t)=>e+(t.part.to-t.part.from+1),0)+s;return{expandIndex:r,partIndex:s,globalPartIndex:a,expand:n}},M=async(e,t)=>{let r=[];try{let n=await (0,f.fetchTimelapsePartBin)(e,t),s=await n.arrayBuffer(),a=await (0,m.gzipAB)(s),l=new Uint16Array(a.buffer),o=[];l.forEach(e=>{o.push(e),3===o.length&&(r.push(o),o=[])})}catch(e){console.log("Error:",e)}return r},R=(e,t,r)=>{let n=e.getContext("2d"),s=document.createElement("canvas"),a=s.getContext("2d");s.width=e.width,s.height=e.height,a.drawImage(e,0,0),e.width=t,e.height=r,n.fillStyle="#ffffff",n.fillRect(0,0,t,r),n.drawImage(s,0,0)};var f=l("5Ml5F"),q=l("d165e");(0,f.start)().then(e=>{if("fail"===e){document.location.reload();return}(0,q.connect)()}).catch(()=>{}),(0,i.createRoot)(document.getElementById("root")).render((0,o.jsx)(()=>{let[n,s]=(0,c.useState)([]),[a,l]=(0,c.useState)(""),[i,q]=(0,c.useState)({}),[S,N]=(0,c.useState)(15e3),b=(0,c.useRef)(S),E=(0,c.useRef)(null),I=(0,c.useRef)({fillRect:()=>null}),C=(0,c.useRef)(!1),[_,W]=(0,c.useState)(!1),B=(0,c.useRef)(0),H=(0,c.useRef)(0),[O,k]=(0,c.useState)(0),z=(0,c.useRef)([]),$=(0,c.useRef)(null),F=(0,c.useRef)(null),P=(0,c.useRef)(0),T=(0,c.useRef)(-1),D=(0,c.useRef)(()=>{}),V=(0,c.useRef)(()=>{}),[Y,A]=(0,c.useState)(-1),[L,Z]=(0,c.useState)(-1),[U,X]=(0,c.useState)(""),G=(0,c.useMemo)(()=>a?`${f.staticHost}/timelapse/${a}/${O}.png`:"",[a,O]),J=(0,c.useMemo)(()=>{let{width:e}=$.current?$.current.getBoundingClientRect():{};return(e-3)/i.total},[i]),{wsStore:K,isAuthorized:Q,isOnline:ee,hasNewMessage:et,setHasNewMessage:er}=(0,g.useWsStore)(),en=e(d)(),es=(0,h.useModal)({content:(0,o.jsx)(x.Login,{}),width:"300px"}),ea=async()=>{try{let e=await (0,f.fetchTimelapse)(a);q(e)}catch(e){}},el=async e=>{z.current[e]||(z.current[e]=!0,z.current[e]=await M(a,e),A(e))},eo=()=>{F.current&&(F.current.style.width=`${H.current*J}px`)},ei=()=>{B.current=Date.now(),C.current=!0,W(!0),eu()},ec=()=>{C.current=!1,W(!1)},eu=()=>{if(!C.current||!i.expands)return;let e=Date.now()-B.current;if(e){let t=Math.floor(b.current/1e3*e);eo();let{expandIndex:r,partIndex:n,globalPartIndex:s,expand:a}=y(i,H.current),l=a.index.from+n*i.partSize,o=Math.min(a.index.to-1,l+i.partSize-1),c=i.expands[r-1],u=(c&&c.index.to||0)+n*i.partSize;s<=i.totalParts-1&&!z.current[s+1]&&el(s+1);let d=o-H.current;d<t&&(t=d),T.current!==r&&(T.current=r,r&&(R(E.current,a.canvas.width,a.canvas.height),D.current()));for(let e=0;e<t;e++){let t=H.current-u+e;try{if(t>=0){let[e,r,n]=z.current[s][t];I.current.fillStyle=i.colors[e],I.current.fillRect(r,n,1,1),P.current=P.current+1}}catch(e){console.log("Error:",e,t)}}H.current=H.current+(t<=0?1:t)}if(B.current=Date.now(),H.current>=i.total-1){ec();return}requestAnimationFrame(eu)},ed=()=>{if(!i.expands||C.current)return;let{partIndex:e,globalPartIndex:t,expand:r}=y(i,H.current),n=H.current-(r.index.from+e*i.partSize);V.current();for(let e=0;e<n;e++)try{let[r,n,s]=z.current[t][e];I.current.fillStyle=i.colors[r],I.current.fillRect(n,s,1,1)}catch(e){console.log("Error:",e);return}},ex=()=>{C.current?ec():ei()};return(0,c.useEffect)(()=>{i&&i.episode===a&&z.current[O]&&z.current[O].length&&ed()},[O,a,i,Y,L]),(0,c.useEffect)(()=>{a&&(ec(),H.current=0,z.current=[],k(0),el(0),ea(),eo())},[a]),(0,c.useEffect)(()=>{b.current=S},[S]),(0,c.useEffect)(()=>{let e=e=>{32===e.keyCode&&ex()};return document.body.addEventListener("keyup",e),()=>{document.body.removeEventListener("keyup",e)}},[i]),(0,c.useEffect)(()=>{let e=setInterval(()=>{X(`${(0,m.formatNumber)(H.current?H.current+1:0)} / ${i?(0,m.formatNumber)(i.total||0):0}`)},300);return()=>{clearInterval(e)}},[i]),(0,c.useEffect)(()=>{(0,f.fetchTimelapseSeasons)().then(e=>{s(e.seasons),l(e.seasons[e.seasons.length-1].key)}).catch(()=>{})},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:e(u)("gWqsmq_root",{mobile:en}),children:[(0,o.jsx)(x.HeaderLogo,{}),(0,o.jsx)(x.HeaderControls,{isAuthorized:Q,name:K?K.name:"",isOnline:ee,hasNewMessage:et,setHasNewMessage:er,login:es.open,role:h.ERole.user}),(0,o.jsx)(x.Canvas,{color:"",isOnline:ee,onInit:({image:e,centering:t,resetImage:r})=>{E.current=e,I.current=e&&e.getContext&&e.getContext("2d"),D.current=t,V.current=r},viewOnly:!0,src:G}),(0,o.jsxs)("div",{className:"gWqsmq_bar",children:[(0,o.jsx)("div",{className:"gWqsmq_timelapse",ref:$,onClick:e=>{if(!i.expands)return;let{width:t,left:r}=$.current?$.current.getBoundingClientRect():{},n=Math.floor((e.clientX-r)/t*i.total),{globalPartIndex:s}=y(i,n);ec(),H.current=n,Z(n),eo(),k(s),el(s)},children:(()=>{if(!$.current&&!i.total)return null;let{width:t}=$.current.getBoundingClientRect(),r=t/i.total;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{ref:F,className:"gWqsmq_progress"},"progress"),i.expands&&i.expands.slice(1).map(t=>(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:e(u)("gWqsmq_position","gWqsmq_positionExpand"),style:{left:`${Math.floor(t.index.from*r)}px`}},`${t.index.from}-${t.index.to}`)}))]})})()}),(0,o.jsxs)("div",{className:"gWqsmq_controls",children:[(0,o.jsxs)("div",{className:"gWqsmq_leftControls",children:[(0,o.jsx)("button",{className:t,onClick:ex,children:_?(0,o.jsx)(v,{}):(0,o.jsx)(p,{})}),(0,o.jsx)("div",{className:r}),(0,o.jsx)("button",{className:t,onClick:()=>{N(e=>Math.floor(e/1.1))},children:(0,o.jsx)(j,{})}),(0,o.jsx)("button",{className:t,onClick:()=>{N(e=>Math.floor(1.1*e))},children:(0,o.jsx)(w,{})}),Number((S/15e3).toFixed(2)),"X",(0,o.jsx)("div",{className:r}),U," pix"]}),(0,o.jsxs)("div",{children:["Сезон:",(0,o.jsxs)("select",{onChange:e=>{l(e.target.value)},children:[n.map((e,t,{length:r})=>e.delimiter?(0,o.jsx)("hr",{},e.key):(0,o.jsx)("option",{value:e.key,selected:t===r-1,children:e.label},e.key)),0===n.length&&(0,o.jsx)("option",{children:"Загрузка..."})]})]})]})]})]}),es.render()]})},{}));